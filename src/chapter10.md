# 10. Date and Time API

>【バージョン】 Date and Time API は Java SE 8 で導入された API です。Java SE 6/7 では Date and Time API の開発者が提供する互換ライブラリ "ThreeTen backport" を追加することでほとんどの機能を利用することが可能です。

## 10.1. 「時」に関する基礎事項

### 10.1.1. 「時」とは？

時の基本単位は「秒」と定められています。 「秒」は７つある SI 基本単位（他の単位の組み合わせでは表せない単位）の１つとなっています。 「秒」を基本として、時刻は次のように定義されています。

* 1 分 = 60 秒
* 1 時間 = 60 分 = 3,600 秒
* 1 日 = 24 時間 = 86,400 秒

もっとも、歴史的には逆で、１日の半分を占める日の出～日没（または日没～日の出）を 12 等分したものを 1 時間、 1 時間の 60 分の 1 が 1 分、1 分の 60 分の 1 が 1 秒とされ、数千年に渡って使用されてきました。

>100 等分でなく 60 等分を用いたのは、現在のような時のシステムを作り上げた古代メソポタミア文明のバビロニア王朝で、 60 進法が日常的に使われていたためと言われています。また、1 日を 10 でなく 12 等分したのは、インドで 0 の概念が発見される前に時のシステムが成立したためです。 0 が発見されるまで 10 進法はマイナーで、2、3、4、6 のいずれでも割り切れる 12 が位取りとして世界各所で好まれていました。

現在のように「秒」を時の基準とするようになったのは 20 世紀半ば以降です。 観測技術が進み 1 日の長さが厳密には一定でないことがわかり、代わりに秒を超高精度に刻むことが可能な原子時計を基準とすることにしました。原子時計に関する詳細は割愛しますが、天体観測の結果より桁違いに精度が高く体感できる時刻とかけ離れてしまうことから、原子時計の時刻に「うるう秒」を加えて天体観測の結果に近づけた UTC (協定世界時) が基準として用いられます。

>Date and Time API では、うるう秒は考慮しません（仕様検討時には考慮するモードもありました）。

### 10.1.2. 地方時と時差

現在、世界の標準時として使用されているのは UTC (協定世界時) で、これは本初子午線 (経度 0 度) において太陽が南中した時刻を 12 時 (正午) とする GMT (グリニッジ標準時) と概ね一致します。

私たちが使用している時刻は、例えば日本では JST (日本標準時) であり、UTC と異なることが少なくありません。太陽が南中した時刻をその土地の 12 時とする時刻を地方時と言い、JST は地方時の１つです。JST は UTC よりも 9 時間進んでいるため、UTC で 0 時ちょうどの時、JST では 9 時となります。さらにアメリカ西海岸の地方時である PST は UTC より 8 時間遅れているため、UTC で 0 時ちょうどの時、PST では前の日の 16 時 (夏時間の場合は 15 時) となります。これが時差と呼ばれるものです。

ISO 8601 では UTC からのずれで時差を表現しますが、Java では同じ時差を持つ地域であるタイムゾーンを Time Zone Database (tz database) としてデータベース化して利用しています。tz database は時差に加え夏時間の情報、さらにはこれらの履歴をも保持しています。tz database の原本はインターネットの標準化団体である ICANN と IANA による管理の下で常に更新が行われており、Java 実行環境 (JRE) のアップデート時に最新版が反映されるようになっています。Date and Time API では ISO 8601 に基づく時差と tz database が定めるタイムゾーンの双方を利用できるようになっています。

## 10.2. ISO 8601 について

Date and Time API は、日付と時刻の表記に関する国際標準である "ISO 8601" をモデリングした API です。ISO 8601 はコンピュータ上で確実に取り扱うことを第一義として定められています。 ISO 8601 は一般に用いられているグレゴリオ暦を用います (一部のキリスト教会で用いるユリウス暦ではないことに注意してください)。日本では ISO 8601 を翻訳した上で日本独自の和暦表記の規則を追加した "JIS X 0301" という日本標準規格を制定しており、その他の国々も ISO 8601 ベースの標準規格を定めています。 また、ISO 8601 のサブセットとしてインターネット標準として用いられている RFC 3339 があります。

ここで注意したいことは、ISO 8601 はコンピュータ上で普及している Unix 時刻と互換性がないということです。 このことは、ISO 8601 に準拠した Date and Time API は、旧来の `java.util.Data`/`java.util.Calendar` との互換性がないことを意味します。 意外と見落とされがちな事実なので注意してください。

以降、ISO 8601 の表記法についてはスライドを参照してください。

ISO 8601 の詳細については以下の解説記事を参照してください。

* [ISO 8601 -- Date and Time API の基礎理論(1)](http://www.coppermine.jp/docs/programming/2015/06/iso8601-1.html)
* [ISO 8601 -- Date and Time API の基礎理論(2)](http://www.coppermine.jp/docs/programming/2015/06/iso8601-2.html)

## 10.3. Date and Time API の基本

スライドを参照してください。

## 10.4. 高度なトピック

この章の内容は高度なトピックのため、最初は飛ばしてしまっても構いません。

### 10.4.1. Instant と Clock

スライドを参照してください。

### 10.4.2. ZoneId と ZoneOffset

スライドを参照してください。

### 10.4.3. Temporal オブジェクトとは？

スライドを参照してください。

### 10.4.4. 暦のサポート

スライドを参照してください。

## 10.5. Date and Time API のまとめ

Date and Time API を一言で表すなら、「日付と時刻の標準規格 ISO 8601 をモデリングした API」です。 クラス数は少なくありませんが、一つひとつの基本的な使い方は難しくありません。

日付・時刻に関する演算が充実しており、それは旧来の `java.util.Data` や `java.util.Calendar と比べると一目瞭然です。 特に `TemporalAdjuster` は、例えば「次の土曜日」のように抽象的な日付を算出できる強力な機能です。

また、多数の拡張ポイントを備えていることも特徴です。 暦サポートクラスを収めた `java.time.chrono` パッケージを見て、その柔軟性を確認してください。

Date and Time API は初学者にとって敷居の高い API の一つとみなされています。 しかし、手順を踏んで学べば決して難しいものではありません。 日付や時刻といった日常にあるものを表現している分だけイメージはしやすいはずです。以下に学習指針を示しますので、まずはこの通りに進めてみてください。

1. ISO 8601 (または JIS X 0301) を学ぶ。
2. LocalDate クラスの使い方をマスターする。
3. なぜ Local/Offset/Zoned の３種類のクラスが存在するのかを知る。
4. 自分達の仕事で重点的に使う範囲を絞り込む。
5. あとはトライ・アンド・エラー！